<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Exercise set 3</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for data analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="exercise_sheet_1.html">Exercises 1</a>
</li>
<li>
  <a href="exercise_sheet_2.html">Exercises 2</a>
</li>
<li>
  <a href="exercise_sheet_3.html">Exercises 3</a>
</li>
<li>
  <a href="exercise_sheet_4.html">Exercises 4</a>
</li>
<li>
  <a href="exercise_sheet_5.html">Final assignment</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exercise set 3</h1>

</div>


<div id="learning-goals" class="section level2">
<h2>Learning goals</h2>
<p>After completing these tasks, you’ll be able to convert raw data into tidy format. You will also be able to make publication quality plots using ggplot2. New concepts: tidy data, grammar of graphics, aesthetics. New packages: tidyverse (specifically tidyr, dplyr, ggplot2), patchwork</p>
</div>
<div id="tidy-data" class="section level2">
<h2>3.1 Tidy data</h2>
<p>Please note that it’s not always easy to decide how to get your data from its current state to tidy! If you feel a little overwhelmed with your own data set and how to get it to where it needs to be, you can book a one-on-one meeting with me for Tuesday 12th May (see Moodle for how). We can go over your specific project and I can give you tips on how to proceed! In the mean time, you can complete these tasks with the example data set.</p>
<div id="loading-and-inspecting-data" class="section level3">
<h3>Loading and inspecting data</h3>
<p>If your own data set is already clean, you can also practice these steps with the exercise_data_messy.csv which is available on Moodle. On the other hand, if you have raw data which needs cleaning, you can also do this on your own data set. The solutions are shown on the exercise data. You’ll need to have the package tidyverse installed and loaded to work these exercises. See a handy cheat sheet for many of the commands we’re using today <a href="./images/data-import.pdf">here</a></p>
<p>Q3.1.1 Load in your data using <code>read_csv</code>.</p>
<p>Tip: If your csv uses semicolon (;) instead of comma as a separator, you should use read_csv2 instead.</p>
<p>Q3.1.2 Inspect your data as we learned last time. How many missing values? Are there any values that might be wrongly coded NA’s?</p>
<p>Tip: Look for negative values for variables which cannot be negative, like age, or much higher values than what is feasible, like BMI over 100. You can also try plotting your variables to observe very clear outliers.</p>
<p>Q3.1.3 Fix any wrongly coded NA’s. If you’re changing a single value, you can use <code>data %&gt;% mutate(&lt;columnname&gt; = na_if(&lt;olumnname&gt;, &lt;valuetoreplace&gt;))</code>. If you’re changing multiple values, you can use <code>data %&gt;% mutate(&lt;columnname&gt; = ifelse(&lt;columnname&gt;[logical expression, e.g. &gt;100], NA, &lt;columnname&gt;))</code></p>
<p>Q3.1.4 Make sure all of your factors are factors. If not, transform them with <code>mutate</code></p>
</div>
<div id="massaging-data" class="section level3">
<h3>Massaging data</h3>
<p>Q3.1.5 See if you want to rename some columns with <code>rename</code> to make the names shorter (and therefore quicker to type). In the example data set, the first five columns could benefit from a shorter name.</p>
<p>Q3.1.6 See if you need to gather/spread the data. In the example data set, try to convert the data to the same format as the data set from the previous exercise was (i.e. each food type has its own column).</p>
<p>Q3.1.7 Create a new column by combining values from existing columns with <code>mutate</code>. If you’re working on the example data set, you can e.g. sum values for different types of bread into a new column called ‘Bread’.</p>
<p>Q3.1.8 summary &amp; group_by</p>
</div>
</div>
<div id="better-plotting" class="section level2">
<h2>3.2 Better plotting</h2>
<p>Let’s remake the bar chart from last set of exercises, but this time with ggplot2.</p>
<p>Q3.2.1 Start by making a basic histogram</p>
<pre class="r"><code>ggplot(data, aes(x=Freshveg)) +
  geom_histogram()</code></pre>
<p>Q3.2.2 Make sure you understand the different components of this function call. What does “aes” refer to? What happens if you remove the “+” at the end of the first row?</p>
<p>Q3.2.3 Ask the visuals to show boys and girls separately by adding <code>fill=sex</code> (assuming you renamed co_Gender to sex in Q3.1.5).</p>
<p>Q3.2.4 Oops, looks like ggplot will by default stack the bars and not show them side by side. You can solve this by adding <code>position=&quot;identity&quot;</code> as an argument for <code>geom_histogram</code>.</p>
<p>Q3.2.5 In some cases you can now only see the colour which is plotted on top. To make the bars slightly see-through, add <code>alpha=0.5</code> in the call for <code>geom_histogram</code>. You can also try to give other values between 0 and 1 to alpha. Will larger numbers make it more see-through or more solid?</p>
<p>Q3.2.6 To get the plot to show probability density instead of number of responses in a bin, add <code>aes(y=..density..)</code> to geom_histogram.</p>
<p>Q3.2.7 Add title to the plot and axis labels with <code>labs(title=&quot;Consumption of fresh vegetables&quot;, x=&quot;Times per week&quot;, y = &quot;Density&quot;)</code></p>
<p>Tip: Remember that with ggplot, adding new elements happens by adding a + at the end of your previously last line and then adding the new function call below</p>
<p>Q3.2.8 Now we get to the fun part! You can change the look of the plot by choosing a theme. Look at the themes here <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html#examples" class="uri">https://ggplot2.tidyverse.org/reference/ggtheme.html#examples</a> and apply one of them to your plot.</p>
<p>Q3.2.9 We can easily add other elements to the plot. For example, adding <code>geom_density(alpha=0.2)</code> as a new function will overlay probability density function for our data. To superimpose a normal distribution curve, we can add <code>stat_function(fun = dnorm, n = 101, args = list(mean = mean(data$Freshveg, na.rm=T), sd = sd(data$Freshveg, na.rm=T)), colour='red')</code></p>
<p>Q3.2.10 Now save the plot.</p>
<p>Tip: You cann either put your <code>pdf()</code> and <code>dev.off()</code> calls around the whole thing, or you can first assign the whole plot call to a variable (so the first line starts with <code>p1 &lt;- ggplot</code> etc.)</p>
<p>Q</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
