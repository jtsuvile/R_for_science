<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Exercise set 3</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for data analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="exercise_sheet_1.html">Exercises 1</a>
</li>
<li>
  <a href="exercise_sheet_2.html">Exercises 2</a>
</li>
<li>
  <a href="exercise_sheet_3.html">Exercises 3</a>
</li>
<li>
  <a href="exercise_sheet_4.html">Exercises 4</a>
</li>
<li>
  <a href="exercise_sheet_5.html">Final assignment</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-lightbulb-o"></span>
     
    Solutions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="solutions_exercise_1.html">Solutions 1</a>
    </li>
    <li>
      <a href="solutions_exercise_2.html">Solutions 2</a>
    </li>
    <li>
      <a href="solutions_exercise_3.html">Solutions 3</a>
    </li>
    <li>
      <a href="solutions_exercise_4.html">Solutions 4</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Exercise set 3</h1>

</div>


<div id="learning-goals" class="section level2">
<h2>Learning goals</h2>
<p>After completing these tasks, you'll be able to convert raw data into tidy format. You will also be able to make publication quality plots using ggplot2. New concepts: tidy data, grammar of graphics, aesthetics. New packages: tidyverse (specifically tidyr, dplyr, ggplot2), patchwork</p>
</div>
<div id="videos" class="section level2">
<h2>Videos</h2>
<p><a href="https://www.youtube.com/playlist?list=PLDDYJXmrJm8WHa_aERVDo6s-TVARaa-jJ">You can find the demo videos introducing new concepts and giving you tools to complete these exercises here</a></p>
</div>
<div id="tidy-data" class="section level2">
<h2>3.1 Tidy data</h2>
<p>Please note that it's not always easy to decide how to get your data from its current state to tidy! If you feel a little overwhelmed with your own data set and how to get it to where it needs to be, you can book a one-on-one meeting with me for Tuesday 12th May (see Moodle for how). We can go over your specific project and I can give you tips on how to proceed! In the mean time, you can complete these tasks with the example data set.</p>
<div id="loading-and-inspecting-data" class="section level3">
<h3>Loading and inspecting data</h3>
<p>If your own data set is already clean, you can also practice these steps with the exercise_data_messy.csv which is available on Moodle. On the other hand, if you have raw data which needs cleaning, you can also do this on your own data set. The solutions are shown on the exercise data. You'll need to have the package tidyverse installed and loaded to work these exercises. See a handy cheat sheet for many of the commands we're using today <a href="./images/data-import.pdf">here</a></p>
<p>Q3.1.1 Load in your data using <code>read_csv</code>.</p>
<p>Tip: If your csv uses semicolon (;) instead of comma as a separator, you should use read_csv2 instead.</p>
</div>
<div id="wrangling-data" class="section level3">
<h3>Wrangling data</h3>
<p>Q3.1.2 What needs to get done to make your data tidy? For example, do you need to go from long to wide (<code>spread</code>) or wide to long (<code>gather</code>) or join data from different files (<code>full_join</code>)?</p>
<p>Q3.1.3 Try to do that! In the example data set, I would argue that it makes most sense to have the data in a wide format (i.e. each food type has its own column). See if you can get it to there!</p>
</div>
<div id="manipulating-data" class="section level3">
<h3>Manipulating data</h3>
<p>Q3.1.4 Inspect your data as we learned last time. How many missing values? Are there any values that might be wrongly coded NA's?</p>
<p>Tip: Look for negative values for variables which cannot be negative, like age, or much higher values than what is feasible, like BMI over 100. You can also try plotting your variables to observe very clear outliers.</p>
<p>Q3.1.5 Fix any wrongly coded NA's. If you're changing a single value, you can use <code>data %&gt;% mutate(&lt;columnname&gt; = na_if(&lt;columnname&gt;, &lt;valuetoreplace&gt;))</code>. If you're changing multiple values, you can use <code>data %&gt;% mutate(&lt;columnname&gt; = ifelse(&lt;columnname&gt;[logical expression, e.g. &gt;100], NA, &lt;columnname&gt;))</code></p>
<p>Q3.1.6 Make sure all of your factors are factors. If not, transform them with <code>mutate</code></p>
<p>Q3.1.7 See if you want to rename some columns with <code>rename</code> to make the names shorter (and therefore quicker to type). In the example data set, the first five columns could benefit from a shorter name.</p>
<p>Q3.1.8 Create a new column by combining values from existing columns with <code>mutate</code>. If you're working on the example data set, you can e.g. sum values for different types of bread into a new column called 'Bread'.</p>
<p>Q3.1.9 Use <code>group_by</code> to group your data according to some factor(s) and then use <code>tally()</code> (doesn't need any arguments if you use %&gt;% to give it your data) to count occurrences in those groups.</p>
</div>
</div>
<div id="better-plotting" class="section level2">
<h2>3.2 Better plotting</h2>
<div id="lets-remake-the-bar-chart-from-last-set-of-exercises-but-this-time-with-ggplot2." class="section level3">
<h3>Let's remake the bar chart from last set of exercises, but this time with ggplot2.</h3>
<p>Q3.2.1 Start by making a basic histogram</p>
<pre class="r"><code>ggplot(data, aes(x=Freshveg)) +
  geom_histogram()</code></pre>
<p>Q3.2.2 Make sure you understand the different components of this function call. What does &quot;aes&quot; refer to? What happens if you remove the &quot;+&quot; at the end of the first row?</p>
<p>Q3.2.3 Ask the visuals to show boys and girls separately by adding <code>fill=sex</code> (assuming you renamed co_Gender to sex in Q3.1.5).</p>
<p>Tip: the value you give fill has to be a factor - if you did not mutate your factors, you should do that now</p>
<p>Q3.2.4 Oops, looks like ggplot will by default stack the bars and not show them side by side. You can solve this by adding <code>position=&quot;identity&quot;</code> as an argument for <code>geom_histogram</code>.</p>
<p>Q3.2.5 In some cases you can now only see the colour which is plotted on top. To make the bars slightly see-through, add <code>alpha=0.5</code> in the call for <code>geom_histogram</code>. You can also try to give other values between 0 and 1 to alpha. Will larger numbers make it more see-through or more solid?</p>
<p>Q3.2.6 To get the plot to show probability density instead of number of responses in a bin, add <code>aes(y=..density..)</code> to geom_histogram.</p>
<p>Q3.2.7 Add title to the plot and axis labels with <code>labs(title=&quot;Consumption of fresh vegetables&quot;, x=&quot;Times per week&quot;, y = &quot;Density&quot;)</code></p>
<p>Tip: Remember that with ggplot, adding new elements happens by adding a + at the end of your previously last line and then adding the new function call below</p>
<p>Q3.2.8 Now we get to the fun part! You can change the look of the plot by choosing a theme. Look at the themes here <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html#examples" class="uri">https://ggplot2.tidyverse.org/reference/ggtheme.html#examples</a> and apply one of them to your plot.</p>
<p>Q3.2.9 We can easily add other elements to the plot. For example, adding <code>geom_density(alpha=0.2)</code> as a new function will overlay probability density function for our data. To superimpose a normal distribution curve, we can add <code>stat_function(fun = dnorm, n = 101, args = list(mean = mean(data$Freshveg, na.rm=T), sd = sd(data$Freshveg, na.rm=T)), colour='red')</code></p>
<p>Q3.2.10 Now save the plot.</p>
<p>Tip: You cann either put your <code>pdf()</code> and <code>dev.off()</code> calls around the whole thing, or you can first assign the whole plot call to a variable (so the first line starts with <code>p1 &lt;- ggplot</code> etc.)</p>
</div>
<div id="now-make-a-figure-with-your-own-data-if-you-have-some" class="section level3">
<h3>Now make a figure with your own data, if you have some!</h3>
<p>Q3.2.11 Start by creating a simple scatter plot with <code>geom_point</code>. If you want to add a bit of visual jitter (e.g. your data has a lot of similar values), you can use <code>geom_jitter</code> instead.</p>
<p>Q3.2.12 Add a trend line with <code>geom_smooth</code>.</p>
<p>Q3.2.13 Fine tune your plot: add more legible axis names if needed, pick your theme, change colours and and shapes of the dots. <a href="./images/data-visualization.pdf">See this cheat sheet for help with ggplot!</a></p>
</div>
<div id="lets-plot-multiple-plots-in-the-same-fig" class="section level3">
<h3>Let's plot multiple plots in the same fig</h3>
<p>Q3.2.14 Install and source package &quot;patchwork&quot;</p>
<p>Q3.2.15 Assign the barchart we did to p1 and the new plot you made to p2</p>
<p>Q3.2.16 Run <code>p1 + p2</code></p>
<p>Q3.2.17 Run <code>p1 / p2</code></p>
<p>Q3.2.18 Which one do you prefer? How would you add a third plot?</p>
</div>
<div id="bonus" class="section level3">
<h3>Bonus:</h3>
<p>Think of a plot type you would like to do with your own data. Can you figure out how to do that in ggplot2? If you have made a plot from your own data with ggplot2, please share it on the course forum to show off and to motivate others!</p>
<p>Tip: Google (especially the image search) is your best friend in this! You can google ggplot2 <whateverplot> (e.g. ggplot2 violin plot) to find examples of how to do that type of plot in ggplot2.</p>
</div>
</div>

&nbsp;
<style>
* {
  box-sizing: border-box;
}

/* Create three equal columns that floats next to each other */
.column {
  float: left;
  width: 33.33%;
  padding: 10px;
  height: 300px; /* Should be removed. Only for demonstration */
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}
</style>
<hr />
<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<div class="row">
  <div class="column">
  	<p style="text-align: left;"><span style="color: #808080;">Created by <a href="https://users.aalto.fi/~jtsuvile/">Juulia Suvilehto </a>
	<br><em>juulia.suvilehto@iki.fi</em></span>
<br>
    <a href="https://twitter.com/JSuvilehto" class="fa fa-twitter"></a>
    <a href="https://www.linkedin.com/in/suvilehto/" class="fa fa-linkedin"></a>
    <a href="https://github.com/jtsuvile" class="fa fa-github"></a>
</p>
  </div>
  <div class="column">
  	<p style="text-align: right;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a></p>
  </div>
    <div class="column">
  	<p style="text-align: right;">This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a></p>
  </div>
</div>


&nbsp;



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
